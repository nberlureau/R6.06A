---
// src/pages/home.astro
import "../styles/global.css";
import "../styles/style.css";
---

<!doctype html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>GlossAI - Your Glossaries</title>
    </head>

    <body class="bg-gray-50">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-8 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <img
                        src="static/logo.png"
                        alt="GlossAI Logo"
                        width="200px"
                    />
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="px-8 py-8">
            <div class="max-w-7xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-semibold text-gray-900">
                        Your glossaries
                    </h2>
                    <div class="flex gap-3">
                        <button
                            id="importGlossaryBtn"
                            class="bg-primary hover-bg-primary text-white px-6 py-2.5 rounded-lg font-medium transition-colors"
                        >
                            Import glossary
                        </button>
                        <button
                            id="newGlossaryBtn"
                            class="bg-primary hover-bg-primary text-white px-6 py-2.5 rounded-lg font-medium transition-colors"
                        >
                            New glossary
                        </button>
                    </div>
                </div>

                <!-- Glossaries List -->
                <div id="glossariesContainer" class="space-y-4">
                    <!-- Glossaries will be inserted here -->
                </div>

                <!-- Empty state -->
                <div id="emptyState" class="hidden text-center py-20">
                    <p class="text-gray-500 text-lg">No glossaries yet</p>
                    <p class="text-gray-400 mt-2">
                        Create your first glossary to get started
                    </p>
                </div>
            </div>
        </main>

        <!-- Modal New Glossary -->
        <div id="newGlossaryModal" class="hidden fixed inset-0 z-50">
            <div
                class="modal-overlay absolute inset-0 bg-opacity-30 backdrop-blur-sm"
                id="newGlossaryModalOverlay"
            >
            </div>
            <div class="flex items-center justify-center min-h-screen p-4">
                <div
                    class="modal-content bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-10 relative"
                >
                    <h3 class="text-2xl font-semibold text-gray-900 mb-8">
                        Add a new glossary
                    </h3>

                    <div
                        class="bg-gray-50 rounded-2xl p-8 space-y-6 border border-gray-100"
                    >
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">
                            Details of the glossary
                        </h4>

                        <div>
                            <label
                                class="block text-sm font-medium text-gray-900 mb-2"
                            >
                                Name <span class="text-red-600">*</span>
                            </label>
                            <input
                                type="text"
                                id="glossaryNameInput"
                                placeholder="Enter the name of the glossary"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all bg-white"
                            />
                            <p
                                id="glossaryNameError"
                                class="text-red-600 text-sm mt-1 hidden"
                            >
                                This field is required!
                            </p>
                        </div>

                        <div>
                            <label
                                class="block text-sm font-medium text-gray-900 mb-2"
                            >
                                Description <span class="text-red-600">*</span>
                            </label>
                            <textarea
                                id="glossaryDescriptionInput"
                                placeholder="Enter the description of the glossary"
                                rows="4"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all resize-none bg-white"
                            ></textarea>
                            <p
                                id="glossaryDescriptionError"
                                class="text-red-600 text-sm mt-1 hidden"
                            >
                                This field is required!
                            </p>
                        </div>
                    </div>

                    <div class="flex justify-end gap-3 mt-8">
                        <button
                            id="cancelNewGlossaryBtn"
                            class="px-8 py-3 border border-gray-300 rounded-lg font-medium text-gray-900 hover:bg-gray-50 transition-colors"
                        >
                            Cancel
                        </button>
                        <button
                            id="submitNewGlossaryBtn"
                            class="px-8 py-3 bg-primary hover-bg-primary text-white rounded-lg font-medium transition-colors"
                        >
                            Add
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal View Glossary -->
        <div id="viewGlossaryModal" class="hidden fixed inset-0 z-50">
            <div
                class="modal-overlay absolute inset-0 bg-opacity-30 backdrop-blur-sm"
                id="viewGlossaryModalOverlay"
            >
            </div>
            <div class="flex items-center justify-center min-h-screen p-4">
                <div
                    class="modal-content bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-10 relative"
                >
                    <h3 class="text-2xl font-semibold text-gray-900 mb-8">
                        Glossary Details
                    </h3>

                    <div
                        class="bg-gray-50 rounded-2xl p-8 space-y-6 border border-gray-100"
                    >
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">
                            Glossary Information
                        </h4>

                        <div>
                            <label
                                class="block text-sm font-medium text-gray-900 mb-2"
                            >
                                Name
                            </label>
                            <p
                                id="viewGlossaryName"
                                class="text-gray-900 text-lg"
                            >
                            </p>
                        </div>

                        <div>
                            <label
                                class="block text-sm font-medium text-gray-900 mb-2"
                            >
                                Description
                            </label>
                            <p
                                id="viewGlossaryDescription"
                                class="text-gray-600 text-lg"
                            >
                            </p>
                        </div>

                        <div>
                            <label
                                class="block text-sm font-medium text-gray-900 mb-2"
                            >
                                Number of Terms
                            </label>
                            <p
                                id="viewGlossaryTermCount"
                                class="text-gray-600 text-lg"
                            >
                            </p>
                        </div>
                    </div>

                    <div class="flex justify-end gap-3 mt-8">
                        <button
                            id="closeViewGlossaryBtn"
                            class="px-8 py-3 border border-gray-300 rounded-lg font-medium text-gray-900 hover:bg-gray-50 transition-colors"
                        >
                            Close
                        </button>
                        <button
                            id="openGlossaryBtn"
                            class="px-8 py-3 bg-primary hover-bg-primary text-white rounded-lg font-medium transition-colors"
                        >
                            Open Glossary
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Edit Glossary -->
        <div id="editGlossaryModal" class="hidden fixed inset-0 z-50">
            <div
                class="modal-overlay absolute inset-0 bg-opacity-30 backdrop-blur-sm"
                id="editGlossaryModalOverlay"
            >
            </div>
            <div class="flex items-center justify-center min-h-screen p-4">
                <div
                    class="modal-content bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-10 relative"
                >
                    <h3 class="text-2xl font-semibold text-gray-900 mb-8">
                        Edit Glossary
                    </h3>

                    <div
                        class="bg-gray-50 rounded-2xl p-8 space-y-6 border border-gray-100"
                    >
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">
                            Edit Glossary Details
                        </h4>

                        <div>
                            <label
                                class="block text-sm font-medium text-gray-900 mb-2"
                            >
                                Name <span class="text-red-600">*</span>
                            </label>
                            <input
                                type="text"
                                id="editGlossaryNameInput"
                                placeholder="Enter the name of the glossary"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all bg-white"
                            />
                            <p
                                id="editGlossaryNameError"
                                class="text-red-600 text-sm mt-1 hidden"
                            >
                                This field is required!
                            </p>
                        </div>

                        <div>
                            <label
                                class="block text-sm font-medium text-gray-900 mb-2"
                            >
                                Description <span class="text-red-600">*</span>
                            </label>
                            <textarea
                                id="editGlossaryDescriptionInput"
                                placeholder="Enter the description of the glossary"
                                rows="4"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent outline-none transition-all resize-none bg-white"
                            ></textarea>
                            <p
                                id="editGlossaryDescriptionError"
                                class="text-red-600 text-sm mt-1 hidden"
                            >
                                This field is required!
                            </p>
                        </div>
                    </div>

                    <div class="flex justify-end gap-3 mt-8">
                        <button
                            id="cancelEditGlossaryBtn"
                            class="px-8 py-3 border border-gray-300 rounded-lg font-medium text-gray-900 hover:bg-gray-50 transition-colors"
                        >
                            Cancel
                        </button>
                        <button
                            id="submitEditGlossaryBtn"
                            class="px-8 py-3 bg-primary hover-bg-primary text-white rounded-lg font-medium transition-colors"
                        >
                            Save
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Import Glossary -->
        <div id="importModal" class="hidden fixed inset-0 z-50">
            <div
                class="modal-overlay absolute inset-0 bg-opacity-30 backdrop-blur-sm"
                id="importModalOverlay"
            >
            </div>
            <div class="flex items-center justify-center min-h-screen p-4">
                <div
                    class="modal-content bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative"
                >
                    <h3 class="text-2xl font-semibold text-gray-900 mb-6">
                        Import Glossary
                    </h3>

                    <div class="space-y-4 mb-6">
                        <p class="text-gray-600">Choose file to import:</p>

                        <div
                            class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center cursor-pointer hover:border-gray-400 transition-colors"
                            id="importDropZone"
                        >
                            <input
                                type="file"
                                id="importFileInput"
                                accept=".md,.json"
                                class="hidden"
                            />
                            <div class="flex flex-col items-center gap-3">
                                <svg
                                    class="w-12 h-12 text-gray-400"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
                                    ></path>
                                </svg>
                                <p class="text-gray-600">
                                    Click to select a file
                                </p>
                                <p class="text-sm text-gray-500">
                                    Supports: .md, .json
                                </p>
                            </div>
                        </div>

                        <div
                            id="importError"
                            class="text-red-600 text-sm hidden"
                        >
                        </div>
                    </div>

                    <div class="flex justify-end gap-3">
                        <button
                            id="importCancelBtn"
                            class="px-6 py-2 border border-gray-300 rounded-lg font-medium text-gray-900 hover:bg-gray-50 transition-colors"
                        >
                            Cancel
                        </button>
                        <button
                            id="importConfirmBtn"
                            class="px-6 py-2 bg-primary hover-bg-primary text-white rounded-lg font-medium transition-colors"
                        >
                            Import
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== VARIABLES GLOBALES =====
            let glossaries =
                JSON.parse(localStorage.getItem("glossaries")) || [];
            let nextGlossaryId =
                Math.max(...glossaries.map((g) => g.id), 0) + 1;
            let currentEditGlossaryId = null;

            // ===== FONCTIONS DE BASE =====
            function saveGlossaries() {
                localStorage.setItem("glossaries", JSON.stringify(glossaries));
            }

            function renderGlossaries() {
                const container = document.getElementById(
                    "glossariesContainer",
                );
                const emptyState = document.getElementById("emptyState");

                if (glossaries.length === 0) {
                    container.innerHTML = "";
                    emptyState.classList.remove("hidden");
                    return;
                }

                emptyState.classList.add("hidden");
                container.innerHTML = glossaries
                    .map(
                        (glossary) => `
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow cursor-pointer" onclick="redirectToGlossary(${glossary.id})">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h3 class="text-xl font-semibold text-gray-900 mb-2">
                                    ${glossary.name}
                                </h3>
                                <p class="text-gray-600 text-sm">
                                    ${glossary.description}
                                </p>
                            </div>
                            <div class="flex gap-2 ml-4" onclick="event.stopPropagation()">
                                <button
                                    onclick="viewGlossary(${glossary.id})"
                                    class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"
                                    title="View"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                    </svg>
                                </button>
                                <button
                                    onclick="editGlossary(${glossary.id})"
                                    class="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"
                                    title="Edit"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                    </svg>
                                </button>
                                <button
                                    onclick="deleteGlossary(${glossary.id})"
                                    class="p-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                    title="Delete"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `,
                    )
                    .join("");
            }

            // ===== FONCTIONS POUR LES GLOSSAIRES =====
            window.redirectToGlossary = function (id) {
                window.location.href = `/glossary?id=${id}`;
            };

            window.viewGlossary = function (id) {
                const glossary = glossaries.find((g) => g.id === id);
                if (!glossary) return;

                // Remplir les informations dans la modale View
                document.getElementById("viewGlossaryName").textContent =
                    glossary.name;
                document.getElementById("viewGlossaryDescription").textContent =
                    glossary.description;
                document.getElementById("viewGlossaryTermCount").textContent =
                    glossary.terms.length;

                // Configurer le bouton "Open Glossary" pour rediriger
                document.getElementById("openGlossaryBtn").onclick = () => {
                    window.location.href = `/glossary?id=${id}`;
                };

                openViewGlossaryModal();
            };

            window.editGlossary = function (id) {
                const glossary = glossaries.find((g) => g.id === id);
                if (!glossary) return;

                currentEditGlossaryId = id;

                // Remplir les champs avec les valeurs actuelles
                document.getElementById("editGlossaryNameInput").value =
                    glossary.name;
                document.getElementById("editGlossaryDescriptionInput").value =
                    glossary.description;

                openEditGlossaryModal();
            };

            window.deleteGlossary = function (id) {
                if (confirm("Are you sure you want to delete this glossary?")) {
                    glossaries = glossaries.filter((g) => g.id !== id);
                    saveGlossaries();
                    renderGlossaries();
                }
            };

            // ===== GESTION DES MODALES =====
            const newGlossaryModal =
                document.getElementById("newGlossaryModal");
            const newGlossaryBtn = document.getElementById("newGlossaryBtn");
            const cancelNewGlossaryBtn = document.getElementById(
                "cancelNewGlossaryBtn",
            );
            const submitNewGlossaryBtn = document.getElementById(
                "submitNewGlossaryBtn",
            );
            const newGlossaryModalOverlay = document.getElementById(
                "newGlossaryModalOverlay",
            );

            const viewGlossaryModal =
                document.getElementById("viewGlossaryModal");
            const viewGlossaryModalOverlay = document.getElementById(
                "viewGlossaryModalOverlay",
            );
            const closeViewGlossaryBtn = document.getElementById(
                "closeViewGlossaryBtn",
            );

            const editGlossaryModal =
                document.getElementById("editGlossaryModal");
            const editGlossaryModalOverlay = document.getElementById(
                "editGlossaryModalOverlay",
            );
            const cancelEditGlossaryBtn = document.getElementById(
                "cancelEditGlossaryBtn",
            );
            const submitEditGlossaryBtn = document.getElementById(
                "submitEditGlossaryBtn",
            );

            const importModal = document.getElementById("importModal");
            const importGlossaryBtn =
                document.getElementById("importGlossaryBtn");
            const importCancelBtn = document.getElementById("importCancelBtn");
            const importModalOverlay =
                document.getElementById("importModalOverlay");
            const importDropZone = document.getElementById("importDropZone");
            const importFileInput = document.getElementById("importFileInput");
            const importConfirmBtn =
                document.getElementById("importConfirmBtn");
            const importError = document.getElementById("importError");

            function openNewGlossaryModal() {
                newGlossaryModal.classList.remove("hidden");
                document.body.style.overflow = "hidden";
            }

            function closeNewGlossaryModal() {
                newGlossaryModal.classList.add("hidden");
                document.body.style.overflow = "auto";
                document.getElementById("glossaryNameInput").value = "";
                document.getElementById("glossaryDescriptionInput").value = "";
                clearNewGlossaryErrors();
            }

            function clearNewGlossaryErrors() {
                document
                    .getElementById("glossaryNameError")
                    .classList.add("hidden");
                document
                    .getElementById("glossaryDescriptionError")
                    .classList.add("hidden");
                document
                    .getElementById("glossaryNameInput")
                    .classList.remove("border-red-500");
                document
                    .getElementById("glossaryDescriptionInput")
                    .classList.remove("border-red-500");
            }

            function openViewGlossaryModal() {
                viewGlossaryModal.classList.remove("hidden");
                document.body.style.overflow = "hidden";
            }

            function closeViewGlossaryModal() {
                viewGlossaryModal.classList.add("hidden");
                document.body.style.overflow = "auto";
            }

            function openEditGlossaryModal() {
                editGlossaryModal.classList.remove("hidden");
                document.body.style.overflow = "hidden";
            }

            function closeEditGlossaryModal() {
                editGlossaryModal.classList.add("hidden");
                document.body.style.overflow = "auto";
                currentEditGlossaryId = null;
                clearEditGlossaryErrors();
            }

            function clearEditGlossaryErrors() {
                document
                    .getElementById("editGlossaryNameError")
                    .classList.add("hidden");
                document
                    .getElementById("editGlossaryDescriptionError")
                    .classList.add("hidden");
                document
                    .getElementById("editGlossaryNameInput")
                    .classList.remove("border-red-500");
                document
                    .getElementById("editGlossaryDescriptionInput")
                    .classList.remove("border-red-500");
            }

            function openImportModal() {
                importModal.classList.remove("hidden");
                document.body.style.overflow = "hidden";
                importError.classList.add("hidden");
                importFileInput.value = "";
            }

            function closeImportModal() {
                importModal.classList.add("hidden");
                document.body.style.overflow = "auto";
                importError.classList.add("hidden");
            }

            // ===== ÉVÉNEMENTS =====
            newGlossaryBtn.addEventListener("click", openNewGlossaryModal);
            cancelNewGlossaryBtn.addEventListener(
                "click",
                closeNewGlossaryModal,
            );
            newGlossaryModalOverlay.addEventListener(
                "click",
                closeNewGlossaryModal,
            );

            closeViewGlossaryBtn.addEventListener(
                "click",
                closeViewGlossaryModal,
            );
            viewGlossaryModalOverlay.addEventListener(
                "click",
                closeViewGlossaryModal,
            );

            cancelEditGlossaryBtn.addEventListener(
                "click",
                closeEditGlossaryModal,
            );
            editGlossaryModalOverlay.addEventListener(
                "click",
                closeEditGlossaryModal,
            );

            importGlossaryBtn.addEventListener("click", openImportModal);
            importCancelBtn.addEventListener("click", closeImportModal);
            importModalOverlay.addEventListener("click", closeImportModal);
            importDropZone.addEventListener("click", () =>
                importFileInput.click(),
            );

            // Clear errors on input
            document
                .getElementById("glossaryNameInput")
                .addEventListener("input", () => {
                    document
                        .getElementById("glossaryNameError")
                        .classList.add("hidden");
                    document
                        .getElementById("glossaryNameInput")
                        .classList.remove("border-red-500");
                });

            document
                .getElementById("glossaryDescriptionInput")
                .addEventListener("input", () => {
                    document
                        .getElementById("glossaryDescriptionError")
                        .classList.add("hidden");
                    document
                        .getElementById("glossaryDescriptionInput")
                        .classList.remove("border-red-500");
                });

            document
                .getElementById("editGlossaryNameInput")
                .addEventListener("input", () => {
                    document
                        .getElementById("editGlossaryNameError")
                        .classList.add("hidden");
                    document
                        .getElementById("editGlossaryNameInput")
                        .classList.remove("border-red-500");
                });

            document
                .getElementById("editGlossaryDescriptionInput")
                .addEventListener("input", () => {
                    document
                        .getElementById("editGlossaryDescriptionError")
                        .classList.add("hidden");
                    document
                        .getElementById("editGlossaryDescriptionInput")
                        .classList.remove("border-red-500");
                });

            // Submit new glossary
            submitNewGlossaryBtn.addEventListener("click", () => {
                const nameInput = document.getElementById("glossaryNameInput");
                const descriptionInput = document.getElementById(
                    "glossaryDescriptionInput",
                );
                const name = nameInput.value.trim();
                const description = descriptionInput.value.trim();

                clearNewGlossaryErrors();
                let hasError = false;

                if (!name) {
                    document
                        .getElementById("glossaryNameError")
                        .classList.remove("hidden");
                    nameInput.classList.add("border-red-500");
                    hasError = true;
                }

                if (!description) {
                    document
                        .getElementById("glossaryDescriptionError")
                        .classList.remove("hidden");
                    descriptionInput.classList.add("border-red-500");
                    hasError = true;
                }

                if (hasError) return;

                // Create new glossary
                const newGlossary = {
                    id: nextGlossaryId++,
                    name,
                    description,
                    terms: [],
                };

                glossaries.push(newGlossary);
                saveGlossaries();
                renderGlossaries();
                closeNewGlossaryModal();

                // Redirect to the new glossary
                window.location.href = `/glossary?id=${newGlossary.id}`;
            });

            // Submit edit glossary
            submitEditGlossaryBtn.addEventListener("click", () => {
                const nameInput = document.getElementById(
                    "editGlossaryNameInput",
                );
                const descriptionInput = document.getElementById(
                    "editGlossaryDescriptionInput",
                );
                const name = nameInput.value.trim();
                const description = descriptionInput.value.trim();

                clearEditGlossaryErrors();
                let hasError = false;

                if (!name) {
                    document
                        .getElementById("editGlossaryNameError")
                        .classList.remove("hidden");
                    nameInput.classList.add("border-red-500");
                    hasError = true;
                }

                if (!description) {
                    document
                        .getElementById("editGlossaryDescriptionError")
                        .classList.remove("hidden");
                    descriptionInput.classList.add("border-red-500");
                    hasError = true;
                }

                if (hasError) return;

                // Update glossary
                const glossaryIndex = glossaries.findIndex(
                    (g) => g.id === currentEditGlossaryId,
                );
                if (glossaryIndex !== -1) {
                    glossaries[glossaryIndex].name = name;
                    glossaries[glossaryIndex].description = description;
                    saveGlossaries();
                    renderGlossaries();
                    closeEditGlossaryModal();
                }
            });

            // Import glossary - CORRECTION IMPORTANTE
            // Import glossary - VERSION AVEC IMPORT DES FONCTIONS
            importConfirmBtn.addEventListener("click", async () => {
                const file = importFileInput.files[0];
                if (!file) {
                    importError.textContent = "Please select a file";
                    importError.classList.remove("hidden");
                    return;
                }

                const fileExtension = file.name.split(".").pop().toLowerCase();
                if (!["md", "json"].includes(fileExtension)) {
                    importError.textContent =
                        "Please select a .md or .json file";
                    importError.classList.remove("hidden");
                    return;
                }

                try {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const fileContent = e.target.result;

                        if (fileExtension === "md") {
                            const { parseMarkdown } = await import(
                                "../lib/export_documents.js"
                            );
                            const parsedData = parseMarkdown(fileContent);

                            // Create new glossary from imported data
                            const newGlossary = {
                                id: nextGlossaryId++,
                                name: parsedData.title || "Imported Glossary",
                                description:
                                    parsedData.description ||
                                    "Imported from Markdown file",
                                terms: parsedData.data.map((row, index) => ({
                                    id: index + 1,
                                    term: row[0],
                                    definition: row[1],
                                    synonyms: Array.isArray(row[2])
                                        ? row[2]
                                        : [],
                                })),
                            };

                            glossaries.push(newGlossary);
                            saveGlossaries();
                            renderGlossaries();
                            closeImportModal();

                            // Rediriger vers le nouveau glossaire
                            window.location.href = `/glossary?id=${newGlossary.id}`;
                        } else {
                            const { parseJSON } = await import(
                                "../lib/export_documents.js"
                            );
                            const parsedData = parseJSON(fileContent);

                            const newGlossary = {
                                id: nextGlossaryId++,
                                name: parsedData.title || "Imported Glossary",
                                description:
                                    parsedData.description ||
                                    "Imported from JSON file",
                                terms: parsedData.data.map((row, index) => ({
                                    id: index + 1,
                                    term: row[0],
                                    definition: row[1],
                                    synonyms: Array.isArray(row[2])
                                        ? row[2]
                                        : [],
                                })),
                            };

                            glossaries.push(newGlossary);
                            saveGlossaries();
                            renderGlossaries();
                            closeImportModal();

                            // Rediriger vers le nouveau glossaire
                            window.location.href = `/glossary?id=${newGlossary.id}`;
                        }
                    };
                    reader.readAsText(file);
                } catch (error) {
                    console.error("Import error:", error);
                    importError.textContent =
                        "Error importing file: " + error.message;
                    importError.classList.remove("hidden");
                }
            });

            // Close modals with Escape key
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") {
                    if (!newGlossaryModal.classList.contains("hidden")) {
                        closeNewGlossaryModal();
                    }
                    if (!viewGlossaryModal.classList.contains("hidden")) {
                        closeViewGlossaryModal();
                    }
                    if (!editGlossaryModal.classList.contains("hidden")) {
                        closeEditGlossaryModal();
                    }
                    if (!importModal.classList.contains("hidden")) {
                        closeImportModal();
                    }
                }
            });

            // ===== INITIALISATION =====
            renderGlossaries();
        </script>
    </body>
</html>
